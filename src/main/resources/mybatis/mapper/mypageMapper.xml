<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pg.flex.dao.mypage.MyPage">

<resultMap id="ProductResultMap" type="com.pg.flex.dto.UserDetail">
  <result column="saved_file_name" property="savedFileName" />
  <result column="user_id" property="userId" />
  <result column="user_name" property="userName" />
  <result column="total_price" property="totalPrice" />
</resultMap>

<select id="getUserDetail" parameterType="string" resultMap="ProductResultMap">
  SELECT
    ui.saved_file_name,
    u.user_id,
    u.user_name,
    (
      SELECT
        sum(product_price) FROM product AS p
      INNER JOIN 
        order_list AS ol
      ON 
        ol.product_index=p.product_index
      WHERE 
        ol.user_id = u.login_id
    ) AS total_price
  FROM 
    user_info AS u
  INNER JOIN 
    user_image AS ui
	ON 
    ui.user_id=u.login_id
  WHERE
    u.login_id=#{userId}
  </select>

</mapper>
